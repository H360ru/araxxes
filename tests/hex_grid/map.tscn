[gd_scene load_steps=4 format=2]

[ext_resource path="res://modules/navigation_grid.gd" type="Script" id=1]
[ext_resource path="res://tests/hex_grid/tileset_horizontal.tres" type="TileSet" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends Node2D

onready var tmp = $TileMap

var choosing_second = false
var point:Vector2

var area:PoolVector2Array

var path:PoolVector2Array

func _ready():
	area = PoolVector2Array()

func _draw():
	pass
	var mouse_cell = tmp.world_to_map(get_local_mouse_position())
	for i in tmp.navigator.get_points():
		draw_circle(tmp.navigator.get_point_position(i), 20.0, Color.red)
		for j in tmp.navigator.get_point_connections(i):
			# Нереально сильно гасит фпс из-за кривости рисования, все линии рисуются по два раза
			# но это только для дебага
			draw_line(tmp.navigator.get_point_position(i), tmp.navigator.get_point_position(j), Color.red)
			
	for i in tmp._get_three_left_top_neighbors(mouse_cell.x, mouse_cell.y):
		draw_circle(tmp.get_cell_center_local(i), 10.0, Color.green)
		
	if Input.is_action_just_pressed(\"mouse_left\"):
		path = tmp.find_pixel_path(Vector2(5, 2), mouse_cell)
		
	if len(path) > 1:
		draw_polyline(path, Color.green, 3.0, true)
		
	print(tmp.get_map_distance(Vector2(5, 2), mouse_cell))
	area = tmp.get_distance_area(mouse_cell, 5)
	for i in area:
		draw_circle(i, 10.0, Color.blue)

func _process(delta):
	
	if Input.is_action_pressed(\"ui_left\"):
		position.x -= 300*delta
	if Input.is_action_pressed(\"ui_right\"):
		position.x += 300*delta
	if Input.is_action_pressed(\"ui_down\"):
		position.y += 300*delta
	if Input.is_action_pressed(\"ui_up\"):
		position.y -= 300*delta
	
	update()
"

[node name="Map" type="Node2D"]
scale = Vector2( 0.3, 0.3 )
script = SubResource( 1 )

[node name="TileMap" type="TileMap" parent="."]
show_behind_parent = true
tile_set = ExtResource( 2 )
cell_size = Vector2( 120, 103 )
cell_half_offset = 3
centered_textures = true
format = 1
tile_data = PoolIntArray( 65532, 16, 0, 65533, 16, 0, 65534, 16, 0, 65535, 16, 0, 0, 16, 0, 1, 16, 0, 2, 16, 0, 3, 16, 0, 4, 16, 0, 5, 16, 0, 6, 16, 0, 7, 16, 0, 8, 16, 0, 9, 16, 0, 10, 16, 0, 131068, 16, 0, 131069, 16, 0, 131070, 16, 0, 131071, 16, 0, 65536, 16, 0, 65537, 16, 0, 65538, 16, 0, 65539, 2, 0, 65540, 2, 0, 65541, 16, 0, 65542, 16, 0, 65543, 16, 0, 65544, 16, 0, 65545, 16, 0, 65546, 16, 0, 196604, 16, 0, 196605, 16, 0, 196606, 2, 0, 196607, 16, 0, 131072, 16, 0, 131073, 16, 0, 131074, 16, 0, 131075, 16, 0, 131076, 16, 0, 131077, 16, 0, 131078, 16, 0, 131079, 16, 0, 131080, 16, 0, 131081, 16, 0, 131082, 16, 0, 262140, 16, 0, 262141, 16, 0, 262142, 16, 0, 262143, 16, 0, 196608, 1, 0, 196609, 1, 0, 196610, 16, 0, 196611, 4, 0, 196612, 6, 0, 196613, 16, 0, 196614, 16, 0, 196615, 16, 0, 196616, 16, 0, 196617, 16, 0, 196618, 16, 0, 327676, 16, 0, 327677, 16, 0, 327678, 16, 0, 327679, 5, 0, 262144, 16, 0, 262145, 1, 0, 262146, 16, 0, 262147, 6, 0, 262148, 6, 0, 262149, 3, 0, 262150, 16, 0, 262151, 16, 0, 262152, 16, 0, 262153, 16, 0, 262154, 16, 0, 262155, 16, 0, 393212, 16, 0, 393213, 2, 0, 393214, 4, 0, 393215, 16, 0, 327680, 1, 0, 327681, 1, 0, 327682, 16, 0, 327683, 16, 0, 327684, 9, 0, 327685, 8, 0, 327686, 16, 0, 327687, 7, 0, 327688, 16, 0, 327689, 16, 0, 327690, 16, 0, 458748, 16, 0, 458749, 4, 0, 458750, 16, 0, 458751, 16, 0, 393216, 16, 0, 393217, 1, 0, 393218, 1, 0, 393219, 16, 0, 393220, 16, 0, 393221, 16, 0, 393222, 16, 0, 393223, 7, 0, 393224, 16, 0, 393225, 16, 0, 393226, 16, 0, 393227, 16, 0, 524284, 16, 0, 524285, 16, 0, 524286, 13, 0, 524287, 16, 0, 458752, 16, 0, 458753, 1, 0, 458754, 1, 0, 458755, 16, 0, 458756, 16, 0, 458757, 2, 0, 458758, 7, 0, 458759, 16, 0, 458760, 16, 0, 458761, 16, 0, 458762, 16, 0, 589820, 16, 0, 589821, 16, 0, 589822, 16, 0, 589823, 16, 0, 524288, 16, 0, 524289, 16, 0, 524290, 16, 0, 524291, 16, 0, 524292, 16, 0, 524293, 16, 0, 524294, 2, 0, 524295, 16, 0, 524296, 16, 0, 524297, 16, 0, 524298, 16, 0, 524299, 16, 0, 655356, 16, 0, 655357, 16, 0, 655358, 16, 0, 655359, 16, 0, 589824, 16, 0, 589825, 16, 0, 589826, 16, 0, 589827, 16, 0, 589828, 16, 0, 589829, 16, 0, 589830, 16, 0, 589831, 16, 0, 589832, 16, 0, 589833, 16, 0, 589834, 16, 0, 720892, 16, 0, 720893, 16, 0, 720894, 16, 0, 720895, 16, 0, 655360, 16, 0, 655361, 16, 0, 655362, 16, 0, 655363, 16, 0, 655364, 16, 0, 655365, 16, 0, 655366, 16, 0, 655367, 16, 0 )
script = ExtResource( 1 )
obstacles_ids = PoolIntArray( 1, 6 )
